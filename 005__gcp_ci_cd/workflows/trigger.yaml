main:
  params: [args]
  steps:
    - init:
        assign:
          - project: ${sys.get_env("GOOGLE_CLOUD_PROJECT_ID")}
          - topic: "topic_project_005"
          - message1: {"id": "1", "message": "0400 trigger-workflows-to-pub/sub"}
          - message2: {"id": "2", "message": "0400 trigger-workflows-to-cloud-run"}
          - message3: {"id": "3", "message": "0400 trigger-workflows-to-function"}

    - pubSubRequest:
        call: googleapis.pubsub.v1.projects.topics.publish
        args:
          topic: ${"projects/" + project + "/topics/" + topic}
          body:
            messages:
              - data: ${base64.encode(json.encode(message1))}

    - cloudRunRequest:
        call: http.request
        args:
          url: https://image-project-005-55nsgsicwq-uc.a.run.app/v1/logs/
          method: POST
          auth:
            type: OIDC
          headers:
            Content-Type: application/json
          body:
            message: ${json.encode_to_string(message2)}

    - cloudFunctionsRequest:
        call: http.request
        args:
          url: https://us-central1-fine-sublime-315119.cloudfunctions.net/function_project_005
          method: POST
          auth:
            type: OIDC
          headers:
            Content-Type: application/json
          body:
            message: ${json.encode_to_string(message3)}
